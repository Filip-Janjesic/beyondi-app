import { Injectable } from '@angular/core';
import * as i0 from "@angular/core";
export class CookieService {
    constructor() {
        // check if HTML document is available
        this.doc_avail = !!document; // true | false
    }
    /**
     * Show console error
     */
    errNotAvailable() {
        console.error('Document is not available in ng5plus-cookies.');
    }
    /**
     * Add cookie options: domain, path, expires, secure
     * @param cookieStr string
     * @param cookieOpts object
     */
    addCookieOptions(cookieStr, cookieOpts) {
        if (!cookieOpts) {
            return cookieStr;
        }
        // domain=example.com;
        if (!!cookieOpts.domain) {
            const cDomain = 'domain=' + cookieOpts.domain + ';';
            cookieStr += cDomain;
        }
        // path=/;
        if (!!cookieOpts.path) {
            const cPath = 'path=' + cookieOpts.path + ';';
            cookieStr += cPath;
        }
        // expires=Fri, 3 Aug 2001 20:47:11 UTC;
        if (!!cookieOpts.expires) {
            let expires;
            if (typeof cookieOpts.expires === 'number') {
                const d = new Date();
                d.setTime(d.getTime() + (cookieOpts.expires * 24 * 60 * 60 * 1000));
                expires = 'expires=' + d.toUTCString();
            }
            else {
                expires = cookieOpts.expires.toUTCString();
            }
            const cExpires = 'expires=' + expires + ';';
            cookieStr += cExpires;
        }
        // secure;
        if (!!cookieOpts.secure) {
            const cSecure = 'secure;';
            cookieStr += cSecure;
        }
        // HttpOnly;
        if (!!cookieOpts.httpOnly) {
            const cHttpOnly = 'HttpOnly;';
            cookieStr += cHttpOnly;
        }
        // SameSite=lax; or SameSite=strict;
        if (!!cookieOpts.sameSite) {
            const cSameSite = 'SameSite=' + cookieOpts.sameSite + ';';
            cookieStr += cSameSite;
        }
        return cookieStr;
    }
    /**
     * Get all cookies in array format.
     * @return Array
     */
    allCookiesArr() {
        // fetch all cookies
        const allCookies = document.cookie; // authAPIInit1=jedan1; authAPIInit2=dva2; authAPI=
        // create cookie array
        const cookiesArr = allCookies.split(';'); // ["authAPIInit1=jedan1", " authAPIInit2=dva2", " authAPI="]
        // remove empty spaces from left and right side
        const cookiesArrMapped = cookiesArr.map((cookiesPair) => {
            return cookiesPair.trim();
        });
        return cookiesArrMapped; // ["authAPIInit1=jedan1", "authAPIInit2=dva2", "authAPI="]
    }
    /**
     * Set cookie. Cookie value is string.
     * @param name - cookie name
     * @param value - cookie value (string)
     * @param cookieOpts - cookie options: domain, path, expires, secure, HttpOnly, SameSite
     * @param debug - true | false (show errors and debug info)
     */
    put(name, value, cookieOpts, debug) {
        if (!this.doc_avail) {
            if (debug) {
                this.errNotAvailable();
            }
            return;
        }
        // encoding cookie value
        value = encodeURIComponent(value);
        // name=value;
        let cookieStr = name + '=' + value + ';';
        // add cookie options: domain, path, expires, secure, HttpOnly, SameSite
        cookieStr = this.addCookieOptions(cookieStr, cookieOpts);
        // debug
        if (debug) {
            console.log('cookie-put():cookieStr: ', cookieStr);
        }
        // put cookie
        document.cookie = cookieStr;
    }
    /**
     * Set cookie. Cookie value is object.
     * @param name - cookie name
     * @param value - cookie value (object)
     * @param cookieOpts - cookie options: domain, path, expires, secure, HttpOnly, SameSite
     * @param debug - true | false (show errors and debug info)
     */
    putObject(name, value, cookieOpts, debug) {
        if (!this.doc_avail) {
            if (debug) {
                this.errNotAvailable();
            }
            return;
        }
        // convert object to string and encode that string
        const valueStr = encodeURIComponent(JSON.stringify(value));
        // name=value;
        let cookieStr = name + '=' + valueStr + ';';
        // add cookie options: domain, path, expires, secure, HttpOnly, SameSite
        cookieStr = this.addCookieOptions(cookieStr, cookieOpts);
        // debug
        if (debug) {
            console.log('cookie-putObject(): ', cookieStr);
        }
        // put cookie
        document.cookie = cookieStr;
    }
    /**
     * Get all cookies in string format (cook1=jedan1; cook2=dva2;).
     * @param debug - true | false (show errors and debug info)
     * @return string - example: cook1=jedan1; cook2=dva2;
     */
    getAll(debug) {
        if (!this.doc_avail) {
            if (debug) {
                this.errNotAvailable();
            }
            return '';
        }
        // fetch all cookies
        const allCookies = document.cookie; // 'cook1=jedan1; cook2=dva2;'
        // debug
        if (debug) {
            console.log('cookie-getAll(): ', allCookies);
        }
        return allCookies;
    }
    /**
     * Get cookie by specific name. Returned value is string.
     * @param name - cookie name
     * @param debug - true | false (show errors and debug info)
     * @return string
     */
    get(name, debug) {
        if (!this.doc_avail) {
            if (debug) {
                this.errNotAvailable();
            }
            return '';
        }
        // get cookies array
        const cookiesArr = this.allCookiesArr(); // ["authAPIInit1=jedan1", "authAPIInit2=dva2", "authAPI="]
        // extract cookie value for specific name
        let elemArr, cookieVal = '';
        cookiesArr.forEach(function (elem) {
            elemArr = elem.split('='); // ["authAPIInit1", "jedan1"]
            if (elemArr[0] === name) {
                cookieVal = elemArr[1] || '';
            }
        });
        // decoding cookie value
        cookieVal = decodeURIComponent(cookieVal);
        // debug
        if (debug) {
            console.log('cookie-get()-cookiesArr: ', cookiesArr);
            console.log('cookie-get()-cookieVal: ', name, '=', cookieVal);
        }
        return cookieVal;
    }
    /**
     * Get cookie by specific name. Returned value is object.
     * @param name - cookie name
     * @param debug - true | false (show errors and debug info)
     * @return object
     */
    getObject(name, debug) {
        if (!this.doc_avail) {
            if (debug) {
                this.errNotAvailable();
            }
            return null;
        }
        const cookieVal = this.get(name, debug); // %7B%22jen%22%3A1%2C%22dva%22%3A%22dvica%22%7D
        // convert cookie string value to object
        let cookieObj = null;
        try {
            if (cookieVal !== 'undefined' && !!cookieVal) {
                cookieObj = JSON.parse(decodeURIComponent(cookieVal));
            }
        }
        catch (err) {
            console.error('cookie-getObject(): ', err);
        }
        // debug
        if (debug) {
            console.log('cookie-getObject():cookieVal: ', cookieVal);
            console.log('cookie-getObject():cookieObj: ', cookieObj);
        }
        return cookieObj;
    }
    /**
     * Remove cookie by specific name.
     * @param name - cookie name
     * @param debug - true | false (show errors and debug info)
     * @return void
     */
    remove(name, debug) {
        if (!this.doc_avail) {
            if (debug) {
                this.errNotAvailable();
            }
            return;
        }
        // set expires backward to delete cookie
        const dateOld = new Date('1970-01-01T01:00:00');
        // debug
        if (debug) {
            console.log('cookie-remove(): ', name, ' cookie is deleted.');
        }
        // cookie removal
        document.cookie = name + '=;expires=' + dateOld + '; path=/;';
    }
    /**
     * Remove all cookies.
     * @param debug - true | false (show errors and debug info)
     * @return void
     */
    removeAll(debug) {
        if (!this.doc_avail) {
            if (debug) {
                this.errNotAvailable();
            }
            return;
        }
        // set expires backward to delete cookie
        const dateOld = new Date('1970-01-01T01:00:00').toUTCString();
        // get cookies array
        const cookiesArr = this.allCookiesArr(); // ["authAPIInit1=jedan1", "authAPIInit2=dva2", "authAPI="]
        // extract cookie value for specific name
        let elemArr;
        const cookiesArr2 = [];
        cookiesArr.forEach(function (elem) {
            elemArr = elem.split('='); // ["authAPIInit1", "jedan1"]
            document.cookie = elemArr[0] + '=;expires=' + dateOld + '; path=/;';
            cookiesArr2.push(document.cookie);
        });
        // debug
        if (debug) {
            console.log('cookie-removeAll():before:: ', cookiesArr);
            console.log('cookie-removeAll():after:: ', cookiesArr2);
        }
    }
    /**
     * Empty cookie value by specific name.
     * @param name - cookie name
     * @param debug - true | false (show errors and debug info)
     * @return void
     */
    empty(name, debug) {
        if (!this.doc_avail) {
            if (debug) {
                this.errNotAvailable();
            }
            return;
        }
        // empty cookie value
        document.cookie = name + '=;';
        // debug
        if (debug) {
            console.log('cookie-empty(): ', name);
        }
    }
    /**
     * Check if cookie exists.
     * @param name - cookie name
     * @param debug - true | false (show errors and debug info)
     * @return boolean
     */
    exists(name, debug) {
        if (!this.doc_avail) {
            if (debug) {
                this.errNotAvailable();
            }
            return false;
        }
        // get cookies array
        const cookiesArr = this.allCookiesArr(); // ["authAPIInit1=jedan1", "authAPIInit2=dva2", "authAPI="]
        // extract cookie value for specific name
        let elemArr, cookieExists = false;
        cookiesArr.forEach(function (elem) {
            elemArr = elem.split('='); // ["authAPIInit1", "jedan1"]
            if (elemArr[0] === name) {
                cookieExists = true;
            }
        });
        // debug
        if (debug) {
            console.log('cookie-exists(): ', cookieExists);
        }
        return cookieExists;
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.3", ngImport: i0, type: CookieService, deps: [], target: i0.ɵɵFactoryTarget.Injectable }); }
    static { this.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "17.3.3", ngImport: i0, type: CookieService }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.3", ngImport: i0, type: CookieService, decorators: [{
            type: Injectable
        }], ctorParameters: () => [] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29va2llLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ2Jvb3N0LWF1dGgvc3JjL2xpYi9jb29raWUuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDOztBQWUzQyxNQUFNLE9BQU8sYUFBYTtJQUl4QjtRQUNFLHNDQUFzQztRQUN0QyxJQUFJLENBQUMsU0FBUyxHQUFHLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxlQUFlO0lBQzlDLENBQUM7SUFHRDs7T0FFRztJQUNLLGVBQWU7UUFDckIsT0FBTyxDQUFDLEtBQUssQ0FBQywrQ0FBK0MsQ0FBQyxDQUFDO0lBQ2pFLENBQUM7SUFHRDs7OztPQUlHO0lBQ0ssZ0JBQWdCLENBQUMsU0FBaUIsRUFBRSxVQUFnQjtRQUMxRCxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7WUFDaEIsT0FBTyxTQUFTLENBQUM7UUFDbkIsQ0FBQztRQUVELHNCQUFzQjtRQUN0QixJQUFJLENBQUMsQ0FBQyxVQUFVLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDeEIsTUFBTSxPQUFPLEdBQUcsU0FBUyxHQUFHLFVBQVUsQ0FBQyxNQUFNLEdBQUcsR0FBRyxDQUFDO1lBQ3BELFNBQVMsSUFBSSxPQUFPLENBQUM7UUFDdkIsQ0FBQztRQUVELFVBQVU7UUFDVixJQUFJLENBQUMsQ0FBQyxVQUFVLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDdEIsTUFBTSxLQUFLLEdBQUcsT0FBTyxHQUFHLFVBQVUsQ0FBQyxJQUFJLEdBQUcsR0FBRyxDQUFDO1lBQzlDLFNBQVMsSUFBSSxLQUFLLENBQUM7UUFDckIsQ0FBQztRQUVELHdDQUF3QztRQUN4QyxJQUFJLENBQUMsQ0FBQyxVQUFVLENBQUMsT0FBTyxFQUFFLENBQUM7WUFDekIsSUFBSSxPQUFPLENBQUM7WUFDWixJQUFJLE9BQU8sVUFBVSxDQUFDLE9B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QUMsQ0FBQyxDQUFDO1FBRUgsUUFBUTtRQUNSLElBQUksS0FBSyxFQUFFLENBQUM7WUFDVixPQUFPLENBQUMsR0FBRyxDQUFDLG1CQUFtQixFQUFFLFlBQVksQ0FBQyxDQUFDO1FBQ2pELENBQUM7UUFFRCxPQUFPLFlBQVksQ0FBQztJQUN0QixDQUFDOzhHQTNYVSxhQUFhO2tIQUFiLGFBQWE7OzJGQUFiLGFBQWE7a0JBRHpCLFVBQVUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cblxuZXhwb3J0IGludGVyZmFjZSBDb29raWVPcHRpb25zIHtcbiAgZG9tYWluPzogc3RyaW5nO1xuICBwYXRoPzogc3RyaW5nO1xuICBleHBpcmVzPzogbnVtYmVyIHwgRGF0ZTsgLy8gbnVtYmVyIG9mIGRheXMgb3IgZXhhY3QgZGF0ZVxuICBzZWN1cmU/OiBib29sZWFuO1xuICBodHRwT25seT86IGJvb2xlYW47XG4gIHNhbWVTaXRlPzogc3RyaW5nOyAvLyAnc3RyaWN0JyBmb3IgR0VUIGFuZCBQT1NULCAnbGF4JyBvbmx5IGZvciBQT1NUXG59XG5cblxuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgQ29va2llU2VydmljZSB7XG5cbiAgcHJpdmF0ZSBkb2NfYXZhaWw6IGJvb2xlYW47XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgLy8gY2hlY2sgaWYgSFRNTCBkb2N1bWVudCBpcyBhdmFpbGFibGVcbiAgICB0aGlzLmRvY19hdmFpbCA9ICEhZG9jdW1lbnQ7IC8vIHRydWUgfCBmYWxzZVxuICB9XG5cblxuICAvKipcbiAgICogU2hvdyBjb25zb2xlIGVycm9yXG4gICAqL1xuICBwcml2YXRlIGVyck5vdEF2YWlsYWJsZSgpIHtcbiAgICBjb25zb2xlLmVycm9yKCdEb2N1bWVudCBpcyBub3QgYXZhaWxhYmxlIGluIG5nNXBsdXMtY29va2llcy4nKTtcbiAgfVxuXG5cbiAgLyoqXG4gICAqIEFkZCBjb29raWUgb3B0aW9uczogZG9tYWluLCBwYXRoLCBleHBpcmVzLCBzZWN1cmVcbiAgICogQHBhcmFtIGNvb2tpZVN0ciBzdHJpbmdcbiAgICogQHBhcmFtIGNvb2tpZU9wdHMgb2JqZWN0XG4gICAqL1xuICBwcml2YXRlIGFkZENvb2tpZU9wdGlvbnMoY29va2llU3RyOiBzdHJpbmcsIGNvb2tpZU9wdHM/OiBhbnkpIHtcbiAgICBpZiAoIWNvb2tpZU9wdHMpIHtcbiAgICAgIHJldHVybiBjb29raWVTdHI7XG4gICAgfVxuXG4gICAgLy8gZG9tYWluPWV4YW1wbGUuY29tO1xuICAgIGlmICghIWNvb2tpZU9wdHMuZG9tYWluKSB7XG4gICAgICBjb25zdCBjRG9tYWluID0gJ2RvbWFpbj0nICsgY29va2llT3B0cy5kb21haW4gKyAnOyc7XG4gICAgICBjb29raWVTdHIgKz0gY0RvbWFpbjtcbiAgICB9XG5cbiAgICAvLyBwYXRoPS87XG4gICAgaWYgKCEhY29va2llT3B0cy5wYXRoKSB7XG4gICAgICBjb25zdCBjUGF0aCA9ICdwYXRoPScgKyBjb29raWVPcHRzLnBhdGggKyAnOyc7XG4gICAgICBjb29raWVTdHIgKz0gY1BhdGg7XG4gICAgfVxuXG4gICAgLy8gZXhwaXJlcz1GcmksIDMgQXVnIDIwMDEgMjA6NDc6MTEgVVRDO1xuICAgIGlmICghIWNvb2tpZU9wdHMuZXhwaXJlcykge1xuICAgICAgbGV0IGV4cGlyZXM7XG4gICAgICBpZiAodHlwZW9mIGNvb2tpZU9wdHMuZXhwaXJlcyA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgY29uc3QgZCA9IG5ldyBEYXRlKCk7XG4gICAgICAgIGQuc2V0VGltZShkLmdldFRpbWUoKSArIChjb29raWVPcHRzLmV4cGlyZXMgKiAyNCAqIDYwICogNjAgKiAxMDAwKSk7XG4gICAgICAgIGV4cGlyZXMgPSAnZXhwaXJlcz0nICsgZC50b1VUQ1N0cmluZygpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZXhwaXJlcyA9IGNvb2tpZU9wdHMuZXhwaXJlcy50b1VUQ1N0cmluZygpO1xuICAgICAgfVxuICAgICAgY29uc3QgY0V4cGlyZXMgPSAnZXhwaXJlcz0nICsgZXhwaXJlcyArICc7JztcblxuICAgICAgY29va2llU3RyICs9IGNFeHBpcmVzO1xuICAgIH1cblxuICAgIC8vIHNlY3VyZTtcbiAgICBpZiAoISFjb29raWVPcHRzLnNlY3VyZSkge1xuICAgICAgY29uc3QgY1NlY3VyZSA9ICdzZWN1cmU7JztcbiAgICAgIGNvb2tpZVN0ciArPSBjU2VjdXJlO1xuICAgIH1cblxuICAgIC8vIEh0dHBPbmx5O1xuICAgIGlmICghIWNvb2tpZU9wdHMuaHR0cE9ubHkpIHtcbiAgICAgIGNvbnN0IGNIdHRwT25seSA9ICdIdHRwT25seTsnO1xuICAgICAgY29va2llU3RyICs9IGNIdHRwT25seTtcbiAgICB9XG5cbiAgICAvLyBTYW1lU2l0ZT1sYXg7IG9yIFNhbWVTaXRlPXN0cmljdDtcbiAgICBpZiAoISFjb29raWVPcHRzLnNhbWVTaXRlKSB7XG4gICAgICBjb25zdCBjU2FtZVNpdGUgPSAnU2FtZVNpdGU9JyArIGNvb2tpZU9wdHMuc2FtZVNpdGUgKyAnOyc7XG4gICAgICBjb29raWVTdHIgKz0gY1NhbWVTaXRlO1xuICAgIH1cblxuXG4gICAgcmV0dXJuIGNvb2tpZVN0cjtcbiAgfVxuXG5cblxuICAvKipcbiAgICogR2V0IGFsbCBjb29raWVzIGluIGFycmF5IGZvcm1hdC5cbiAgICogQHJldHVybiBBcnJheVxuICAgKi9cbiAgcHJpdmF0ZSBhbGxDb29raWVzQXJyKCkge1xuICAgIC8vIGZldGNoIGFsbCBjb29raWVzXG4gICAgY29uc3QgYWxsQ29va2llcyA9IGRvY3VtZW50LmNvb2tpZTsgLy8gYXV0aEFQSUluaXQxPWplZGFuMTsgYXV0aEFQSUluaXQyPWR2YTI7IGF1dGhBUEk9XG5cbiAgICAvLyBjcmVhdGUgY29va2llIGFycmF5XG4gICAgY29uc3QgY29va2llc0Fycjogc3RyaW5nW10gPSBhbGxDb29raWVzLnNwbGl0KCc7Jyk7IC8vIFtcImF1dGhBUElJbml0MT1qZWRhbjFcIiwgXCIgYXV0aEFQSUluaXQyPWR2YTJcIiwgXCIgYXV0aEFQST1cIl1cblxuICAgIC8vIHJlbW92ZSBlbXB0eSBzcGFjZXMgZnJvbSBsZWZ0IGFuZCByaWdodCBzaWRlXG4gICAgY29uc3QgY29va2llc0Fyck1hcHBlZCA9IGNvb2tpZXNBcnIubWFwKChjb29raWVzUGFpcjogc3RyaW5nKSA9PiB7IC8vIGNvb2tpZVBhaXI6IFwiIGF1dGhBUElJbml0Mj1kdmEyXCJcbiAgICAgIHJldHVybiBjb29raWVzUGFpci50cmltKCk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gY29va2llc0Fyck1hcHBlZDsgLy8gW1wiYXV0aEFQSUluaXQxPWplZGFuMVwiLCBcImF1dGhBUElJbml0Mj1kdmEyXCIsIFwiYXV0aEFQST1cIl1cbiAgfVxuXG5cblxuICAvKipcbiAgICogU2V0IGNvb2tpZS4gQ29va2llIHZhbHVlIGlzIHN0cmluZy5cbiAgICogQHBhcmFtIG5hbWUgLSBjb29raWUgbmFtZVxuICAgKiBAcGFyYW0gdmFsdWUgLSBjb29raWUgdmFsdWUgKHN0cmluZylcbiAgICogQHBhcmFtIGNvb2tpZU9wdHMgLSBjb29raWUgb3B0aW9uczogZG9tYWluLCBwYXRoLCBleHBpcmVzLCBzZWN1cmUsIEh0dHBPbmx5LCBTYW1lU2l0ZVxuICAgKiBAcGFyYW0gZGVidWcgLSB0cnVlIHwgZmFsc2UgKHNob3cgZXJyb3JzIGFuZCBkZWJ1ZyBpbmZvKVxuICAgKi9cbiAgcHV0KG5hbWU6IHN0cmluZywgdmFsdWU6IHN0cmluZywgY29va2llT3B0cz86IENvb2tpZU9wdGlvbnMsIGRlYnVnPzogYm9vbGVhbik6IHZvaWQge1xuICAgIGlmICghdGhpcy5kb2NfYXZhaWwpIHtcbiAgICAgIGlmIChkZWJ1Zykge1xuICAgICAgICB0aGlzLmVyck5vdEF2YWlsYWJsZSgpO1xuICAgICAgfVxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIGVuY29kaW5nIGNvb2tpZSB2YWx1ZVxuICAgIHZhbHVlID0gZW5jb2RlVVJJQ29tcG9uZW50KHZhbHVlKTtcblxuICAgIC8vIG5hbWU9dmFsdWU7XG4gICAgbGV0IGNvb2tpZVN0ciA9IG5hbWUgKyAnPScgKyB2YWx1ZSArICc7JztcblxuICAgIC8vIGFkZCBjb29raWUgb3B0aW9uczogZG9tYWluLCBwYXRoLCBleHBpcmVzLCBzZWN1cmUsIEh0dHBPbmx5LCBTYW1lU2l0ZVxuICAgIGNvb2tpZVN0ciA9IHRoaXMuYWRkQ29va2llT3B0aW9ucyhjb29raWVTdHIsIGNvb2tpZU9wdHMpO1xuXG4gICAgLy8gZGVidWdcbiAgICBpZiAoZGVidWcpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdjb29raWUtcHV0KCk6Y29va2llU3RyOiAnLCBjb29raWVTdHIpO1xuICAgIH1cblxuICAgIC8vIHB1dCBjb29raWVcbiAgICBkb2N1bWVudC5jb29raWUgPSBjb29raWVTdHI7XG4gIH1cblxuXG5cbiAgLyoqXG4gICAqIFNldCBjb29raWUuIENvb2tpZSB2YWx1ZSBpcyBvYmplY3QuXG4gICAqIEBwYXJhbSBuYW1lIC0gY29va2llIG5hbWVcbiAgICogQHBhcmFtIHZhbHVlIC0gY29va2llIHZhbHVlIChvYmplY3QpXG4gICAqIEBwYXJhbSBjb29raWVPcHRzIC0gY29va2llIG9wdGlvbnM6IGRvbWFpbiwgcGF0aCwgZXhwaXJlcywgc2VjdXJlLCBIdHRwT25seSwgU2FtZVNpdGVcbiAgICogQHBhcmFtIGRlYnVnIC0gdHJ1ZSB8IGZhbHNlIChzaG93IGVycm9ycyBhbmQgZGVidWcgaW5mbylcbiAgICovXG4gIHB1dE9iamVjdChuYW1lOiBzdHJpbmcsIHZhbHVlOiBhbnksIGNvb2tpZU9wdHM/OiBDb29raWVPcHRpb25zLCBkZWJ1Zz86IGJvb2xlYW4pOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMuZG9jX2F2YWlsKSB7XG4gICAgICBpZiAoZGVidWcpIHtcbiAgICAgICAgdGhpcy5lcnJOb3RBdmFpbGFibGUoKTtcbiAgICAgIH1cbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBjb252ZXJ0IG9iamVjdCB0byBzdHJpbmcgYW5kIGVuY29kZSB0aGF0IHN0cmluZ1xuICAgIGNvbnN0IHZhbHVlU3RyID0gZW5jb2RlVVJJQ29tcG9uZW50KEpTT04uc3RyaW5naWZ5KHZhbHVlKSk7XG5cbiAgICAvLyBuYW1lPXZhbHVlO1xuICAgIGxldCBjb29raWVTdHIgPSBuYW1lICsgJz0nICsgdmFsdWVTdHIgKyAnOyc7XG5cbiAgICAvLyBhZGQgY29va2llIG9wdGlvbnM6IGRvbWFpbiwgcGF0aCwgZXhwaXJlcywgc2VjdXJlLCBIdHRwT25seSwgU2FtZVNpdGVcbiAgICBjb29raWVTdHIgPSB0aGlzLmFkZENvb2tpZU9wdGlvbnMoY29va2llU3RyLCBjb29raWVPcHRzKTtcblxuICAgIC8vIGRlYnVnXG4gICAgaWYgKGRlYnVnKSB7XG4gICAgICBjb25zb2xlLmxvZygnY29va2llLXB1dE9iamVjdCgpOiAnLCBjb29raWVTdHIpO1xuICAgIH1cblxuICAgIC8vIHB1dCBjb29raWVcbiAgICBkb2N1bWVudC5jb29raWUgPSBjb29raWVTdHI7XG4gIH1cblxuXG5cbiAgLyoqXG4gICAqIEdldCBhbGwgY29va2llcyBpbiBzdHJpbmcgZm9ybWF0IChjb29rMT1qZWRhbjE7IGNvb2syPWR2YTI7KS5cbiAgICogQHBhcmFtIGRlYnVnIC0gdHJ1ZSB8IGZhbHNlIChzaG93IGVycm9ycyBhbmQgZGVidWcgaW5mbylcbiAgICogQHJldHVybiBzdHJpbmcgLSBleGFtcGxlOiBjb29rMT1qZWRhbjE7IGNvb2syPWR2YTI7XG4gICAqL1xuICBnZXRBbGwoZGVidWc/OiBib29sZWFuKTogc3RyaW5nIHtcbiAgICBpZiAoIXRoaXMuZG9jX2F2YWlsKSB7XG4gICAgICBpZiAoZGVidWcpIHsgdGhpcy5lcnJOb3RBdmFpbGFibGUoKTsgfVxuICAgICAgcmV0dXJuICcnO1xuICAgIH1cblxuICAgIC8vIGZldGNoIGFsbCBjb29raWVzXG4gICAgY29uc3QgYWxsQ29va2llcyA9IGRvY3VtZW50LmNvb2tpZTsgLy8gJ2Nvb2sxPWplZGFuMTsgY29vazI9ZHZhMjsnXG5cbiAgICAvLyBkZWJ1Z1xuICAgIGlmIChkZWJ1ZykgeyBjb25zb2xlLmxvZygnY29va2llLWdldEFsbCgpOiAnLCBhbGxDb29raWVzKTsgfVxuXG4gICAgcmV0dXJuIGFsbENvb2tpZXM7XG4gIH1cblxuXG5cbiAgLyoqXG4gICAqIEdldCBjb29raWUgYnkgc3BlY2lmaWMgbmFtZS4gUmV0dXJuZWQgdmFsdWUgaXMgc3RyaW5nLlxuICAgKiBAcGFyYW0gbmFtZSAtIGNvb2tpZSBuYW1lXG4gICAqIEBwYXJhbSBkZWJ1ZyAtIHRydWUgfCBmYWxzZSAoc2hvdyBlcnJvcnMgYW5kIGRlYnVnIGluZm8pXG4gICAqIEByZXR1cm4gc3RyaW5nXG4gICAqL1xuICBnZXQobmFtZTogc3RyaW5nLCBkZWJ1Zz86IGJvb2xlYW4pOiBzdHJpbmcge1xuICAgIGlmICghdGhpcy5kb2NfYXZhaWwpIHtcbiAgICAgIGlmIChkZWJ1ZykgeyB0aGlzLmVyck5vdEF2YWlsYWJsZSgpOyB9XG4gICAgICByZXR1cm4gJyc7XG4gICAgfVxuXG4gICAgLy8gZ2V0IGNvb2tpZXMgYXJyYXlcbiAgICBjb25zdCBjb29raWVzQXJyOiBzdHJpbmdbXSA9IHRoaXMuYWxsQ29va2llc0FycigpOyAvLyBbXCJhdXRoQVBJSW5pdDE9amVkYW4xXCIsIFwiYXV0aEFQSUluaXQyPWR2YTJcIiwgXCJhdXRoQVBJPVwiXVxuXG4gICAgLy8gZXh0cmFjdCBjb29raWUgdmFsdWUgZm9yIHNwZWNpZmljIG5hbWVcbiAgICBsZXQgZWxlbUFyciwgY29va2llVmFsID0gJyc7XG4gICAgY29va2llc0Fyci5mb3JFYWNoKGZ1bmN0aW9uKGVsZW06IHN0cmluZykge1xuICAgICAgZWxlbUFyciA9IGVsZW0uc3BsaXQoJz0nKTsgLy8gW1wiYXV0aEFQSUluaXQxXCIsIFwiamVkYW4xXCJdXG4gICAgICBpZiAoZWxlbUFyclswXSA9PT0gbmFtZSkge1xuICAgICAgICBjb29raWVWYWwgPSBlbGVtQXJyWzFdIHx8ICcnO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gZGVjb2RpbmcgY29va2llIHZhbHVlXG4gICAgY29va2llVmFsID0gZGVjb2RlVVJJQ29tcG9uZW50KGNvb2tpZVZhbCk7XG5cbiAgICAvLyBkZWJ1Z1xuICAgIGlmIChkZWJ1Zykge1xuICAgICAgY29uc29sZS5sb2coJ2Nvb2tpZS1nZXQoKS1jb29raWVzQXJyOiAnLCBjb29raWVzQXJyKTtcbiAgICAgIGNvbnNvbGUubG9nKCdjb29raWUtZ2V0KCktY29va2llVmFsOiAnLCBuYW1lLCAnPScsIGNvb2tpZVZhbCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGNvb2tpZVZhbDtcbiAgfVxuXG5cblxuICAvKipcbiAgICogR2V0IGNvb2tpZSBieSBzcGVjaWZpYyBuYW1lLiBSZXR1cm5lZCB2YWx1ZSBpcyBvYmplY3QuXG4gICAqIEBwYXJhbSBuYW1lIC0gY29va2llIG5hbWVcbiAgICogQHBhcmFtIGRlYnVnIC0gdHJ1ZSB8IGZhbHNlIChzaG93IGVycm9ycyBhbmQgZGVidWcgaW5mbylcbiAgICogQHJldHVybiBvYmplY3RcbiAgICovXG4gIGdldE9iamVjdChuYW1lOiBzdHJpbmcsIGRlYnVnPzogYm9vbGVhbik6IGFueSB7XG4gICAgaWYgKCF0aGlzLmRvY19hdmFpbCkge1xuICAgICAgaWYgKGRlYnVnKSB7IHRoaXMuZXJyTm90QXZhaWxhYmxlKCk7IH1cbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGNvbnN0IGNvb2tpZVZhbCA9IHRoaXMuZ2V0KG5hbWUsIGRlYnVnKTsgLy8gJTdCJTIyamVuJTIyJTNBMSUyQyUyMmR2YSUyMiUzQSUyMmR2aWNhJTIyJTdEXG5cbiAgICAvLyBjb252ZXJ0IGNvb2tpZSBzdHJpbmcgdmFsdWUgdG8gb2JqZWN0XG4gICAgbGV0IGNvb2tpZU9iajogYW55ID0gbnVsbDtcbiAgICB0cnkge1xuICAgICAgaWYgKGNvb2tpZVZhbCAhPT0gJ3VuZGVmaW5lZCcgJiYgISFjb29raWVWYWwpIHtcbiAgICAgICAgY29va2llT2JqID0gSlNPTi5wYXJzZShkZWNvZGVVUklDb21wb25lbnQoY29va2llVmFsKSk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdjb29raWUtZ2V0T2JqZWN0KCk6ICcsIGVycik7XG4gICAgfVxuXG4gICAgLy8gZGVidWdcbiAgICBpZiAoZGVidWcpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdjb29raWUtZ2V0T2JqZWN0KCk6Y29va2llVmFsOiAnLCBjb29raWVWYWwpO1xuICAgICAgY29uc29sZS5sb2coJ2Nvb2tpZS1nZXRPYmplY3QoKTpjb29raWVPYmo6ICcsIGNvb2tpZU9iaik7XG4gICAgfVxuXG4gICAgcmV0dXJuIGNvb2tpZU9iajtcbiAgfVxuXG5cblxuICAvKipcbiAgICogUmVtb3ZlIGNvb2tpZSBieSBzcGVjaWZpYyBuYW1lLlxuICAgKiBAcGFyYW0gbmFtZSAtIGNvb2tpZSBuYW1lXG4gICAqIEBwYXJhbSBkZWJ1ZyAtIHRydWUgfCBmYWxzZSAoc2hvdyBlcnJvcnMgYW5kIGRlYnVnIGluZm8pXG4gICAqIEByZXR1cm4gdm9pZFxuICAgKi9cbiAgcmVtb3ZlKG5hbWU6IHN0cmluZywgZGVidWc/OiBib29sZWFuKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmRvY19hdmFpbCkge1xuICAgICAgaWYgKGRlYnVnKSB7IHRoaXMuZXJyTm90QXZhaWxhYmxlKCk7IH1cbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBzZXQgZXhwaXJlcyBiYWNrd2FyZCB0byBkZWxldGUgY29va2llXG4gICAgY29uc3QgZGF0ZU9sZCA9IG5ldyBEYXRlKCcxOTcwLTAxLTAxVDAxOjAwOjAwJyk7XG5cbiAgICAvLyBkZWJ1Z1xuICAgIGlmIChkZWJ1Zykge1xuICAgICAgY29uc29sZS5sb2coJ2Nvb2tpZS1yZW1vdmUoKTogJywgbmFtZSwgJyBjb29raWUgaXMgZGVsZXRlZC4nKTtcbiAgICB9XG5cbiAgICAvLyBjb29raWUgcmVtb3ZhbFxuICAgIGRvY3VtZW50LmNvb2tpZSA9IG5hbWUgKyAnPTtleHBpcmVzPScgKyBkYXRlT2xkICsgJzsgcGF0aD0vOyc7XG4gIH1cblxuXG5cbiAgLyoqXG4gICAqIFJlbW92ZSBhbGwgY29va2llcy5cbiAgICogQHBhcmFtIGRlYnVnIC0gdHJ1ZSB8IGZhbHNlIChzaG93IGVycm9ycyBhbmQgZGVidWcgaW5mbylcbiAgICogQHJldHVybiB2b2lkXG4gICAqL1xuICByZW1vdmVBbGwoZGVidWc/OiBib29sZWFuKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmRvY19hdmFpbCkge1xuICAgICAgaWYgKGRlYnVnKSB7IHRoaXMuZXJyTm90QXZhaWxhYmxlKCk7IH1cbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBzZXQgZXhwaXJlcyBiYWNrd2FyZCB0byBkZWxldGUgY29va2llXG4gICAgY29uc3QgZGF0ZU9sZCA9IG5ldyBEYXRlKCcxOTcwLTAxLTAxVDAxOjAwOjAwJykudG9VVENTdHJpbmcoKTtcblxuICAgIC8vIGdldCBjb29raWVzIGFycmF5XG4gICAgY29uc3QgY29va2llc0Fycjogc3RyaW5nW10gPSB0aGlzLmFsbENvb2tpZXNBcnIoKTsgLy8gW1wiYXV0aEFQSUluaXQxPWplZGFuMVwiLCBcImF1dGhBUElJbml0Mj1kdmEyXCIsIFwiYXV0aEFQST1cIl1cblxuICAgIC8vIGV4dHJhY3QgY29va2llIHZhbHVlIGZvciBzcGVjaWZpYyBuYW1lXG4gICAgbGV0IGVsZW1BcnI7XG4gICAgY29uc3QgY29va2llc0FycjI6IGFueVtdID0gW107XG4gICAgY29va2llc0Fyci5mb3JFYWNoKGZ1bmN0aW9uKGVsZW06IHN0cmluZykge1xuICAgICAgZWxlbUFyciA9IGVsZW0uc3BsaXQoJz0nKTsgLy8gW1wiYXV0aEFQSUluaXQxXCIsIFwiamVkYW4xXCJdXG4gICAgICBkb2N1bWVudC5jb29raWUgPSBlbGVtQXJyWzBdICsgJz07ZXhwaXJlcz0nICsgZGF0ZU9sZCArICc7IHBhdGg9LzsnO1xuICAgICAgY29va2llc0FycjIucHVzaChkb2N1bWVudC5jb29raWUpO1xuICAgIH0pO1xuXG4gICAgLy8gZGVidWdcbiAgICBpZiAoZGVidWcpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdjb29raWUtcmVtb3ZlQWxsKCk6YmVmb3JlOjogJywgY29va2llc0Fycik7XG4gICAgICBjb25zb2xlLmxvZygnY29va2llLXJlbW92ZUFsbCgpOmFmdGVyOjogJywgY29va2llc0FycjIpO1xuICAgIH1cbiAgfVxuXG5cblxuICAvKipcbiAgICogRW1wdHkgY29va2llIHZhbHVlIGJ5IHNwZWNpZmljIG5hbWUuXG4gICAqIEBwYXJhbSBuYW1lIC0gY29va2llIG5hbWVcbiAgICogQHBhcmFtIGRlYnVnIC0gdHJ1ZSB8IGZhbHNlIChzaG93IGVycm9ycyBhbmQgZGVidWcgaW5mbylcbiAgICogQHJldHVybiB2b2lkXG4gICAqL1xuICBlbXB0eShuYW1lOiBzdHJpbmcsIGRlYnVnPzogYm9vbGVhbik6IHZvaWQge1xuICAgIGlmICghdGhpcy5kb2NfYXZhaWwpIHtcbiAgICAgIGlmIChkZWJ1ZykgeyB0aGlzLmVyck5vdEF2YWlsYWJsZSgpOyB9XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gZW1wdHkgY29va2llIHZhbHVlXG4gICAgZG9jdW1lbnQuY29va2llID0gbmFtZSArICc9Oyc7XG5cbiAgICAvLyBkZWJ1Z1xuICAgIGlmIChkZWJ1Zykge1xuICAgICAgY29uc29sZS5sb2coJ2Nvb2tpZS1lbXB0eSgpOiAnLCBuYW1lKTtcbiAgICB9XG4gIH1cblxuXG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIGNvb2tpZSBleGlzdHMuXG4gICAqIEBwYXJhbSBuYW1lIC0gY29va2llIG5hbWVcbiAgICogQHBhcmFtIGRlYnVnIC0gdHJ1ZSB8IGZhbHNlIChzaG93IGVycm9ycyBhbmQgZGVidWcgaW5mbylcbiAgICogQHJldHVybiBib29sZWFuXG4gICAqL1xuICBleGlzdHMobmFtZTogc3RyaW5nLCBkZWJ1Zz86IGJvb2xlYW4pOiBib29sZWFuIHtcbiAgICBpZiAoIXRoaXMuZG9jX2F2YWlsKSB7XG4gICAgICBpZiAoZGVidWcpIHsgdGhpcy5lcnJOb3RBdmFpbGFibGUoKTsgfVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIGdldCBjb29raWVzIGFycmF5XG4gICAgY29uc3QgY29va2llc0Fycjogc3RyaW5nW10gPSB0aGlzLmFsbENvb2tpZXNBcnIoKTsgLy8gW1wiYXV0aEFQSUluaXQxPWplZGFuMVwiLCBcImF1dGhBUElJbml0Mj1kdmEyXCIsIFwiYXV0aEFQST1cIl1cblxuICAgIC8vIGV4dHJhY3QgY29va2llIHZhbHVlIGZvciBzcGVjaWZpYyBuYW1lXG4gICAgbGV0IGVsZW1BcnIsIGNvb2tpZUV4aXN0cyA9IGZhbHNlO1xuICAgIGNvb2tpZXNBcnIuZm9yRWFjaChmdW5jdGlvbihlbGVtOiBzdHJpbmcpIHtcbiAgICAgIGVsZW1BcnIgPSBlbGVtLnNwbGl0KCc9Jyk7IC8vIFtcImF1dGhBUElJbml0MVwiLCBcImplZGFuMVwiXVxuICAgICAgaWYgKGVsZW1BcnJbMF0gPT09IG5hbWUpIHtcbiAgICAgICAgY29va2llRXhpc3RzID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIGRlYnVnXG4gICAgaWYgKGRlYnVnKSB7XG4gICAgICBjb25zb2xlLmxvZygnY29va2llLWV4aXN0cygpOiAnLCBjb29raWVFeGlzdHMpO1xuICAgIH1cblxuICAgIHJldHVybiBjb29raWVFeGlzdHM7XG4gIH1cblxuXG5cbn1cbiJdfQ==